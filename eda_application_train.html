<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.7.32">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">

<meta name="author" content="Tama Wihongi">
<meta name="dcterms.date" content="2026-01-28">

<title>Exploratory Data Analysis — application_train.csv</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
html { -webkit-text-size-adjust: 100%; }
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>


<script src="eda_application_train_files/libs/clipboard/clipboard.min.js"></script>
<script src="eda_application_train_files/libs/quarto-html/quarto.js" type="module"></script>
<script src="eda_application_train_files/libs/quarto-html/tabsets/tabsets.js" type="module"></script>
<script src="eda_application_train_files/libs/quarto-html/popper.min.js"></script>
<script src="eda_application_train_files/libs/quarto-html/tippy.umd.min.js"></script>
<script src="eda_application_train_files/libs/quarto-html/anchor.min.js"></script>
<link href="eda_application_train_files/libs/quarto-html/tippy.css" rel="stylesheet">
<link href="eda_application_train_files/libs/quarto-html/quarto-syntax-highlighting-37eea08aefeeee20ff55810ff984fec1.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="eda_application_train_files/libs/bootstrap/bootstrap.min.js"></script>
<link href="eda_application_train_files/libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="eda_application_train_files/libs/bootstrap/bootstrap-813c323200a87c37e262811031999de4.min.css" rel="stylesheet" append-hash="true" id="quarto-bootstrap" data-mode="light">


</head>

<body class="quarto-light">

<div id="quarto-content" class="page-columns page-rows-contents page-layout-article">
<div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
  <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">Table of contents</h2>
   
  <ul>
  <li><a href="#business-problem" id="toc-business-problem" class="nav-link active" data-scroll-target="#business-problem"><span class="header-section-number">1</span> Business problem</a></li>
  <li><a href="#setup-and-data-load" id="toc-setup-and-data-load" class="nav-link" data-scroll-target="#setup-and-data-load"><span class="header-section-number">2</span> Setup and data load</a></li>
  <li><a href="#target-variable-and-baseline" id="toc-target-variable-and-baseline" class="nav-link" data-scroll-target="#target-variable-and-baseline"><span class="header-section-number">3</span> Target variable and baseline</a></li>
  <li><a href="#missing-data-scope-and-patterns" id="toc-missing-data-scope-and-patterns" class="nav-link" data-scroll-target="#missing-data-scope-and-patterns"><span class="header-section-number">4</span> Missing data: scope and patterns</a></li>
  <li><a href="#data-cleaning-replace-sentinel-in-days_employed" id="toc-data-cleaning-replace-sentinel-in-days_employed" class="nav-link" data-scroll-target="#data-cleaning-replace-sentinel-in-days_employed"><span class="header-section-number">5</span> Data cleaning: replace sentinel in DAYS_EMPLOYED</a></li>
  <li><a href="#univariate-relationships-numeric-predictors" id="toc-univariate-relationships-numeric-predictors" class="nav-link" data-scroll-target="#univariate-relationships-numeric-predictors"><span class="header-section-number">6</span> Univariate relationships: numeric predictors</a></li>
  <li><a href="#univariate-relationships-categorical-predictors-cramérs-v" id="toc-univariate-relationships-categorical-predictors-cramérs-v" class="nav-link" data-scroll-target="#univariate-relationships-categorical-predictors-cramérs-v"><span class="header-section-number">7</span> Univariate relationships: categorical predictors (Cramér’s V)</a></li>
  <li><a href="#aggregate-previous_application.csv-and-join" id="toc-aggregate-previous_application.csv-and-join" class="nav-link" data-scroll-target="#aggregate-previous_application.csv-and-join"><span class="header-section-number">8</span> Aggregate previous_application.csv and join</a></li>
  <li><a href="#data-problems-and-transformations" id="toc-data-problems-and-transformations" class="nav-link" data-scroll-target="#data-problems-and-transformations"><span class="header-section-number">9</span> Data problems and transformations</a></li>
  <li><a href="#results-and-recommendations" id="toc-results-and-recommendations" class="nav-link" data-scroll-target="#results-and-recommendations"><span class="header-section-number">10</span> Results and recommendations</a></li>
  <li><a href="#how-i-used-ai-in-creating-this-notebook" id="toc-how-i-used-ai-in-creating-this-notebook" class="nav-link" data-scroll-target="#how-i-used-ai-in-creating-this-notebook"><span class="header-section-number">11</span> How I used AI in creating this notebook</a></li>
  <li><a href="#appendix-saving-the-joined-dataset" id="toc-appendix-saving-the-joined-dataset" class="nav-link" data-scroll-target="#appendix-saving-the-joined-dataset"><span class="header-section-number">12</span> Appendix: saving the joined dataset</a></li>
  </ul>
</nav>
</div>
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title">Exploratory Data Analysis — application_train.csv</h1>
</div>



<div class="quarto-title-meta">

    <div>
    <div class="quarto-title-meta-heading">Author</div>
    <div class="quarto-title-meta-contents">
             <p>Tama Wihongi </p>
          </div>
  </div>
    
    <div>
    <div class="quarto-title-meta-heading">Published</div>
    <div class="quarto-title-meta-contents">
      <p class="date">January 28, 2026</p>
    </div>
  </div>
  
    
  </div>
  


</header>


<p><em>The contents have been reviewed and validated by Tama Wihongi on 1/28/2026</em></p>
<section id="business-problem" class="level1" data-number="1">
<h1 data-number="1"><span class="header-section-number">1</span> Business problem</h1>
<p>Lenders need to predict whether an applicant will default on a loan (TARGET = 1). The goal of this EDA is to understand the dataset structure, inspect the target balance, identify strong predictors, document missingness and data problems, and prepare aggregated transactional features (previous applications) for modeling.</p>
</section>
<section id="setup-and-data-load" class="level1" data-number="2">
<h1 data-number="2"><span class="header-section-number">2</span> Setup and data load</h1>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Load helpers and data</span></span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(tidyverse)</span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Read application data</span></span>
<span id="cb1-5"><a href="#cb1-5" aria-hidden="true" tabindex="-1"></a>app_train <span class="ot">&lt;-</span> <span class="fu">read_csv</span>(<span class="st">"application_train.csv"</span>, <span class="at">show_col_types =</span> <span class="cn">FALSE</span>)</span>
<span id="cb1-6"><a href="#cb1-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-7"><a href="#cb1-7" aria-hidden="true" tabindex="-1"></a><span class="co"># Basic metadata</span></span>
<span id="cb1-8"><a href="#cb1-8" aria-hidden="true" tabindex="-1"></a><span class="fu">nrow</span>(app_train)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 307511</code></pre>
</div>
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb3"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ncol</span>(app_train)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 122</code></pre>
</div>
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb5"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Convert TARGET to numeric if necessary (0/1)</span></span>
<span id="cb5-2"><a href="#cb5-2" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> (<span class="fu">is.factor</span>(app_train<span class="sc">$</span>TARGET) <span class="sc">||</span> <span class="fu">is.character</span>(app_train<span class="sc">$</span>TARGET)) {</span>
<span id="cb5-3"><a href="#cb5-3" aria-hidden="true" tabindex="-1"></a>  app_train<span class="sc">$</span>TARGET <span class="ot">&lt;-</span> <span class="fu">as.numeric</span>(<span class="fu">as.character</span>(app_train<span class="sc">$</span>TARGET))</span>
<span id="cb5-4"><a href="#cb5-4" aria-hidden="true" tabindex="-1"></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
</section>
<section id="target-variable-and-baseline" class="level1" data-number="3">
<h1 data-number="3"><span class="header-section-number">3</span> Target variable and baseline</h1>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb6"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Show distribution of TARGET</span></span>
<span id="cb6-2"><a href="#cb6-2" aria-hidden="true" tabindex="-1"></a>target_tab <span class="ot">&lt;-</span> app_train <span class="sc">|&gt;</span> <span class="fu">count</span>(TARGET) <span class="sc">|&gt;</span> <span class="fu">mutate</span>(<span class="at">pct =</span> n <span class="sc">/</span> <span class="fu">sum</span>(n) <span class="sc">*</span> <span class="dv">100</span>)</span>
<span id="cb6-3"><a href="#cb6-3" aria-hidden="true" tabindex="-1"></a><span class="co"># Print a concise table (suppress long raw output)</span></span>
<span id="cb6-4"><a href="#cb6-4" aria-hidden="true" tabindex="-1"></a>target_tab</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 2 × 3
  TARGET      n   pct
   &lt;dbl&gt;  &lt;int&gt; &lt;dbl&gt;
1      0 282686 91.9 
2      1  24825  8.07</code></pre>
</div>
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb8"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Baseline majority-class accuracy</span></span>
<span id="cb8-2"><a href="#cb8-2" aria-hidden="true" tabindex="-1"></a>majority_acc <span class="ot">&lt;-</span> <span class="fu">max</span>(target_tab<span class="sc">$</span>pct) <span class="sc">/</span> <span class="dv">100</span></span>
<span id="cb8-3"><a href="#cb8-3" aria-hidden="true" tabindex="-1"></a>majority_acc</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 0.9192712</code></pre>
</div>
</div>
<p>The target is imbalanced; a majority-class predictor would achieve approximately the reported accuracy above.</p>
</section>
<section id="missing-data-scope-and-patterns" class="level1" data-number="4">
<h1 data-number="4"><span class="header-section-number">4</span> Missing data: scope and patterns</h1>
<p>We first profile NA ammounts to see which columns have extensive NA and whether NA missing patterns are structured.</p>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb10"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb10-1"><a href="#cb10-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Compute NA ammounts summary per column</span></span>
<span id="cb10-2"><a href="#cb10-2" aria-hidden="true" tabindex="-1"></a>miss_cols <span class="ot">&lt;-</span> app_train <span class="sc">|&gt;</span> <span class="fu">summarise</span>(<span class="fu">across</span>(<span class="fu">everything</span>(), <span class="sc">~</span><span class="fu">sum</span>(<span class="fu">is.na</span>(.)))) <span class="sc">|&gt;</span></span>
<span id="cb10-3"><a href="#cb10-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pivot_longer</span>(<span class="fu">everything</span>(), <span class="at">names_to =</span> <span class="st">"column"</span>, <span class="at">values_to =</span> <span class="st">"n_missing"</span>) <span class="sc">|&gt;</span></span>
<span id="cb10-4"><a href="#cb10-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">pct_missing =</span> n_missing <span class="sc">/</span> <span class="fu">nrow</span>(app_train) <span class="sc">*</span> <span class="dv">100</span>) <span class="sc">|&gt;</span> <span class="fu">arrange</span>(<span class="fu">desc</span>(pct_missing))</span>
<span id="cb10-5"><a href="#cb10-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-6"><a href="#cb10-6" aria-hidden="true" tabindex="-1"></a><span class="co"># Show top columns with missing values</span></span>
<span id="cb10-7"><a href="#cb10-7" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(miss_cols, <span class="dv">30</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 30 × 3
   column                   n_missing pct_missing
   &lt;chr&gt;                        &lt;int&gt;       &lt;dbl&gt;
 1 COMMONAREA_AVG              214865        69.9
 2 COMMONAREA_MODE             214865        69.9
 3 COMMONAREA_MEDI             214865        69.9
 4 NONLIVINGAPARTMENTS_AVG     213514        69.4
 5 NONLIVINGAPARTMENTS_MODE    213514        69.4
 6 NONLIVINGAPARTMENTS_MEDI    213514        69.4
 7 FONDKAPREMONT_MODE          210295        68.4
 8 LIVINGAPARTMENTS_AVG        210199        68.4
 9 LIVINGAPARTMENTS_MODE       210199        68.4
10 LIVINGAPARTMENTS_MEDI       210199        68.4
# ℹ 20 more rows</code></pre>
</div>
</div>
<p>Many building/property-related columns (APARTMENTS_<em>, FLOORSMAX_</em>, etc.) have very high NA ammounts. These are likely optional/enrichment fields and not available for a large fraction of applicants.</p>
</section>
<section id="data-cleaning-replace-sentinel-in-days_employed" class="level1" data-number="5">
<h1 data-number="5"><span class="header-section-number">5</span> Data cleaning: replace sentinel in DAYS_EMPLOYED</h1>
<p>We observed a sentinel value 365243 representing unknown employment length. We replace it with NA and create derived fields.</p>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb12"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb12-1"><a href="#cb12-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Replace sentinel and create derived employment years and missing indicator</span></span>
<span id="cb12-2"><a href="#cb12-2" aria-hidden="true" tabindex="-1"></a>app_train <span class="ot">&lt;-</span> app_train <span class="sc">|&gt;</span> </span>
<span id="cb12-3"><a href="#cb12-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">DAYS_EMPLOYED =</span> <span class="fu">if_else</span>(DAYS_EMPLOYED <span class="sc">==</span> <span class="dv">365243</span>, <span class="cn">NA_real_</span>, DAYS_EMPLOYED),</span>
<span id="cb12-4"><a href="#cb12-4" aria-hidden="true" tabindex="-1"></a>         <span class="at">EMPLOYMENT_YEARS =</span> <span class="fu">if_else</span>(<span class="fu">is.na</span>(DAYS_EMPLOYED), <span class="cn">NA_real_</span>, <span class="sc">-</span>DAYS_EMPLOYED <span class="sc">/</span> <span class="fl">365.25</span>),</span>
<span id="cb12-5"><a href="#cb12-5" aria-hidden="true" tabindex="-1"></a>         <span class="at">DAYS_EMPLOYED_MISSING =</span> <span class="fu">is.na</span>(DAYS_EMPLOYED))</span>
<span id="cb12-6"><a href="#cb12-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-7"><a href="#cb12-7" aria-hidden="true" tabindex="-1"></a><span class="co"># Summaries</span></span>
<span id="cb12-8"><a href="#cb12-8" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(app_train<span class="sc">$</span>EMPLOYMENT_YEARS)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>   Min. 1st Qu.  Median    Mean 3rd Qu.    Max.    NA's 
  0.000   2.100   4.512   6.527   8.693  49.040   55374 </code></pre>
</div>
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb14"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb14-1"><a href="#cb14-1" aria-hidden="true" tabindex="-1"></a><span class="fu">mean</span>(app_train<span class="sc">$</span>EMPLOYMENT_YEARS, <span class="at">na.rm =</span> <span class="cn">TRUE</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 6.5275</code></pre>
</div>
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb16"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb16-1"><a href="#cb16-1" aria-hidden="true" tabindex="-1"></a><span class="fu">sum</span>(app_train<span class="sc">$</span>DAYS_EMPLOYED_MISSING)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 55374</code></pre>
</div>
</div>
<p>The sentinel replacement uncovers a meaningful relationship between employment duration and default; NA patterns themself may be predictive and are preserved via a missing indicator.</p>
</section>
<section id="univariate-relationships-numeric-predictors" class="level1" data-number="6">
<h1 data-number="6"><span class="header-section-number">6</span> Univariate relationships: numeric predictors</h1>
<p>We compute correlations (absolute) between numeric variables and TARGET to find candidates for modeling. Long raw correlation matrices are suppressed; we only display the top variables.</p>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb18"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb18-1"><a href="#cb18-1" aria-hidden="true" tabindex="-1"></a>num_cols <span class="ot">&lt;-</span> app_train <span class="sc">|&gt;</span> <span class="fu">select</span>(<span class="fu">where</span>(is.numeric)) <span class="sc">|&gt;</span> <span class="fu">colnames</span>()</span>
<span id="cb18-2"><a href="#cb18-2" aria-hidden="true" tabindex="-1"></a>cor_mat <span class="ot">&lt;-</span> app_train <span class="sc">|&gt;</span> <span class="fu">select</span>(<span class="fu">all_of</span>(num_cols)) <span class="sc">|&gt;</span> <span class="fu">cor</span>(<span class="at">use =</span> <span class="st">"complete.obs"</span>)</span>
<span id="cb18-3"><a href="#cb18-3" aria-hidden="true" tabindex="-1"></a>cor_df <span class="ot">&lt;-</span> <span class="fu">as.data.frame</span>(cor_mat) <span class="sc">|&gt;</span> <span class="fu">rownames_to_column</span>(<span class="st">"variable"</span>)</span>
<span id="cb18-4"><a href="#cb18-4" aria-hidden="true" tabindex="-1"></a>cor_with_target <span class="ot">&lt;-</span> cor_df <span class="sc">|&gt;</span> <span class="fu">select</span>(variable, <span class="at">TARGET =</span> TARGET) <span class="sc">|&gt;</span> <span class="fu">mutate</span>(<span class="at">abs_corr =</span> <span class="fu">abs</span>(TARGET)) <span class="sc">|&gt;</span> <span class="fu">arrange</span>(<span class="fu">desc</span>(abs_corr))</span>
<span id="cb18-5"><a href="#cb18-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-6"><a href="#cb18-6" aria-hidden="true" tabindex="-1"></a><span class="co"># Top numeric predictors</span></span>
<span id="cb18-7"><a href="#cb18-7" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(cor_with_target, <span class="dv">20</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>                      variable      TARGET   abs_corr
1                       TARGET  1.00000000 1.00000000
2                 EXT_SOURCE_3 -0.15702090 0.15702090
3                 EXT_SOURCE_2 -0.13708990 0.13708990
4                 EXT_SOURCE_1 -0.13332773 0.13332773
5  REGION_RATING_CLIENT_W_CITY  0.06258433 0.06258433
6             EMPLOYMENT_YEARS -0.05967961 0.05967961
7                DAYS_EMPLOYED  0.05967961 0.05967961
8         REGION_RATING_CLIENT  0.05456218 0.05456218
9              FLAG_DOCUMENT_3  0.05408129 0.05408129
10               FLOORSMAX_AVG -0.04775644 0.04775644
11              FLOORSMAX_MODE -0.04747916 0.04747916
12              FLOORSMAX_MEDI -0.04719263 0.04719263
13            AMT_INCOME_TOTAL -0.04605426 0.04605426
14                  DAYS_BIRTH  0.04438840 0.04438840
15                 OWN_CAR_AGE  0.03869167 0.03869167
16  AMT_REQ_CREDIT_BUREAU_YEAR  0.03365063 0.03365063
17              FLOORSMIN_MEDI -0.03233709 0.03233709
18               FLOORSMIN_AVG -0.03226575 0.03226575
19              APARTMENTS_AVG -0.03114669 0.03114669
20              TOTALAREA_MODE -0.03108513 0.03108513</code></pre>
</div>
</div>
<p>The top numeric predictors are the external credit scores (EXT_SOURCE_3, EXT_SOURCE_2, EXT_SOURCE_1). DAYS_EMPLOYED (after sentinel fix) rises in importance. Correlations are modest — typical for credit risk datasets — so multivariate models are expected to perform better.</p>
</section>
<section id="univariate-relationships-categorical-predictors-cramérs-v" class="level1" data-number="7">
<h1 data-number="7"><span class="header-section-number">7</span> Univariate relationships: categorical predictors (Cramér’s V)</h1>
<p>We compute simple association strength (Cramér’s V) for selected categorical variables. To keep output short we show the top variables only.</p>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb20"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb20-1"><a href="#cb20-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Define small function for Cramér's V</span></span>
<span id="cb20-2"><a href="#cb20-2" aria-hidden="true" tabindex="-1"></a>cramers_v <span class="ot">&lt;-</span> <span class="cf">function</span>(x, y) {</span>
<span id="cb20-3"><a href="#cb20-3" aria-hidden="true" tabindex="-1"></a>  ct <span class="ot">&lt;-</span> <span class="fu">table</span>(x, y)</span>
<span id="cb20-4"><a href="#cb20-4" aria-hidden="true" tabindex="-1"></a>  chi2 <span class="ot">&lt;-</span> <span class="fu">suppressWarnings</span>(<span class="fu">chisq.test</span>(ct)<span class="sc">$</span>statistic)</span>
<span id="cb20-5"><a href="#cb20-5" aria-hidden="true" tabindex="-1"></a>  n <span class="ot">&lt;-</span> <span class="fu">sum</span>(ct)</span>
<span id="cb20-6"><a href="#cb20-6" aria-hidden="true" tabindex="-1"></a>  k <span class="ot">&lt;-</span> <span class="fu">min</span>(<span class="fu">nrow</span>(ct), <span class="fu">ncol</span>(ct)) <span class="sc">-</span> <span class="dv">1</span></span>
<span id="cb20-7"><a href="#cb20-7" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> (k <span class="sc">&lt;=</span> <span class="dv">0</span>) <span class="fu">return</span>(<span class="cn">NA_real_</span>)</span>
<span id="cb20-8"><a href="#cb20-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">sqrt</span>(chi2 <span class="sc">/</span> (n <span class="sc">*</span> k))</span>
<span id="cb20-9"><a href="#cb20-9" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb20-10"><a href="#cb20-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-11"><a href="#cb20-11" aria-hidden="true" tabindex="-1"></a>cat_cols <span class="ot">&lt;-</span> app_train <span class="sc">|&gt;</span> <span class="fu">select</span>(<span class="fu">where</span>(is.character)) <span class="sc">|&gt;</span> <span class="fu">colnames</span>()</span>
<span id="cb20-12"><a href="#cb20-12" aria-hidden="true" tabindex="-1"></a>cat_assoc <span class="ot">&lt;-</span> <span class="fu">tibble</span>(<span class="at">variable =</span> cat_cols,</span>
<span id="cb20-13"><a href="#cb20-13" aria-hidden="true" tabindex="-1"></a>                    <span class="at">cramers =</span> <span class="fu">sapply</span>(cat_cols, <span class="cf">function</span>(v) {</span>
<span id="cb20-14"><a href="#cb20-14" aria-hidden="true" tabindex="-1"></a>                      <span class="fu">tryCatch</span>(<span class="fu">cramers_v</span>(app_train[[v]], app_train<span class="sc">$</span>TARGET), <span class="at">error =</span> <span class="cf">function</span>(e) <span class="cn">NA_real_</span>)</span>
<span id="cb20-15"><a href="#cb20-15" aria-hidden="true" tabindex="-1"></a>                    })) <span class="sc">|&gt;</span> <span class="fu">arrange</span>(<span class="fu">desc</span>(cramers))</span>
<span id="cb20-16"><a href="#cb20-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-17"><a href="#cb20-17" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(cat_assoc, <span class="dv">20</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 16 × 2
   variable                   cramers
   &lt;chr&gt;                        &lt;dbl&gt;
 1 OCCUPATION_TYPE            0.0815 
 2 ORGANIZATION_TYPE          0.0723 
 3 NAME_INCOME_TYPE           0.0638 
 4 NAME_EDUCATION_TYPE        0.0576 
 5 CODE_GENDER                0.0547 
 6 NAME_FAMILY_STATUS         0.0405 
 7 NAME_HOUSING_TYPE          0.0370 
 8 NAME_CONTRACT_TYPE         0.0309 
 9 WALLSMATERIAL_MODE         0.0303 
10 FLAG_OWN_CAR               0.0218 
11 HOUSETYPE_MODE             0.0134 
12 FONDKAPREMONT_MODE         0.0131 
13 EMERGENCYSTATE_MODE        0.0121 
14 NAME_TYPE_SUITE            0.0104 
15 WEEKDAY_APPR_PROCESS_START 0.00707
16 FLAG_OWN_REALTY            0.00614</code></pre>
</div>
</div>
<p>Occupation type and organization type show the strongest categorical associations with default, though effect sizes (Cramér’s V) are small.</p>
</section>
<section id="aggregate-previous_application.csv-and-join" class="level1" data-number="8">
<h1 data-number="8"><span class="header-section-number">8</span> Aggregate previous_application.csv and join</h1>
<p>We now aggregate previous applications to the applicant level and join to the application data to add behavioral features.</p>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb22"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb22-1"><a href="#cb22-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Read and aggregate previous applications</span></span>
<span id="cb22-2"><a href="#cb22-2" aria-hidden="true" tabindex="-1"></a>prev <span class="ot">&lt;-</span> <span class="fu">read_csv</span>(<span class="st">"previous_application.csv"</span>, <span class="at">show_col_types =</span> <span class="cn">FALSE</span>)</span>
<span id="cb22-3"><a href="#cb22-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-4"><a href="#cb22-4" aria-hidden="true" tabindex="-1"></a>prev_agg <span class="ot">&lt;-</span> prev <span class="sc">|&gt;</span> </span>
<span id="cb22-5"><a href="#cb22-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">is_approved =</span> NAME_CONTRACT_STATUS <span class="sc">==</span> <span class="st">"Approved"</span>,</span>
<span id="cb22-6"><a href="#cb22-6" aria-hidden="true" tabindex="-1"></a>         <span class="at">is_refused =</span> NAME_CONTRACT_STATUS <span class="sc">==</span> <span class="st">"Refused"</span>) <span class="sc">|&gt;</span> </span>
<span id="cb22-7"><a href="#cb22-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(SK_ID_CURR) <span class="sc">|&gt;</span> </span>
<span id="cb22-8"><a href="#cb22-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(<span class="at">prev_count =</span> <span class="fu">n</span>(),</span>
<span id="cb22-9"><a href="#cb22-9" aria-hidden="true" tabindex="-1"></a>            <span class="at">prev_n_status_approved =</span> <span class="fu">sum</span>(is_approved, <span class="at">na.rm =</span> <span class="cn">TRUE</span>),</span>
<span id="cb22-10"><a href="#cb22-10" aria-hidden="true" tabindex="-1"></a>            <span class="at">prev_n_status_refused =</span> <span class="fu">sum</span>(is_refused, <span class="at">na.rm =</span> <span class="cn">TRUE</span>),</span>
<span id="cb22-11"><a href="#cb22-11" aria-hidden="true" tabindex="-1"></a>            <span class="at">prev_rate_approved =</span> prev_n_status_approved <span class="sc">/</span> prev_count,</span>
<span id="cb22-12"><a href="#cb22-12" aria-hidden="true" tabindex="-1"></a>            <span class="at">prev_mean_amt_credit =</span> <span class="fu">mean</span>(AMT_CREDIT, <span class="at">na.rm =</span> <span class="cn">TRUE</span>),</span>
<span id="cb22-13"><a href="#cb22-13" aria-hidden="true" tabindex="-1"></a>            <span class="at">prev_mean_days_decision =</span> <span class="fu">mean</span>(DAYS_DECISION, <span class="at">na.rm =</span> <span class="cn">TRUE</span>)) <span class="sc">|&gt;</span> </span>
<span id="cb22-14"><a href="#cb22-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ungroup</span>()</span>
<span id="cb22-15"><a href="#cb22-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-16"><a href="#cb22-16" aria-hidden="true" tabindex="-1"></a><span class="co"># Left join and inspect</span></span>
<span id="cb22-17"><a href="#cb22-17" aria-hidden="true" tabindex="-1"></a>app_joined <span class="ot">&lt;-</span> app_train <span class="sc">|&gt;</span> <span class="fu">left_join</span>(prev_agg, <span class="at">by =</span> <span class="st">"SK_ID_CURR"</span>)</span>
<span id="cb22-18"><a href="#cb22-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-19"><a href="#cb22-19" aria-hidden="true" tabindex="-1"></a><span class="co"># Show prevalence</span></span>
<span id="cb22-20"><a href="#cb22-20" aria-hidden="true" tabindex="-1"></a>app_joined <span class="sc">|&gt;</span> <span class="fu">summarise</span>(<span class="at">has_prev =</span> <span class="fu">mean</span>(<span class="sc">!</span><span class="fu">is.na</span>(prev_count)) <span class="sc">*</span> <span class="dv">100</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 1 × 1
  has_prev
     &lt;dbl&gt;
1     94.6</code></pre>
</div>
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb24"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb24-1"><a href="#cb24-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Correlation of aggregated features with TARGET (show top)</span></span>
<span id="cb24-2"><a href="#cb24-2" aria-hidden="true" tabindex="-1"></a>agg_num <span class="ot">&lt;-</span> app_joined <span class="sc">|&gt;</span> <span class="fu">select</span>(<span class="fu">starts_with</span>(<span class="st">"prev_"</span>), TARGET) <span class="sc">|&gt;</span> <span class="fu">select</span>(<span class="fu">where</span>(is.numeric))</span>
<span id="cb24-3"><a href="#cb24-3" aria-hidden="true" tabindex="-1"></a>agg_cor <span class="ot">&lt;-</span> <span class="fu">cor</span>(agg_num, <span class="at">use =</span> <span class="st">"complete.obs"</span>)</span>
<span id="cb24-4"><a href="#cb24-4" aria-hidden="true" tabindex="-1"></a>agg_cor_df <span class="ot">&lt;-</span> <span class="fu">as.data.frame</span>(agg_cor) <span class="sc">|&gt;</span> <span class="fu">rownames_to_column</span>(<span class="st">"variable"</span>) <span class="sc">|&gt;</span> <span class="fu">select</span>(variable, <span class="at">TARGET =</span> TARGET)</span>
<span id="cb24-5"><a href="#cb24-5" aria-hidden="true" tabindex="-1"></a>arranged <span class="ot">&lt;-</span> agg_cor_df <span class="sc">|&gt;</span> <span class="fu">mutate</span>(<span class="at">abs_corr =</span> <span class="fu">abs</span>(TARGET)) <span class="sc">|&gt;</span> <span class="fu">arrange</span>(<span class="fu">desc</span>(abs_corr))</span>
<span id="cb24-6"><a href="#cb24-6" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(arranged, <span class="dv">15</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>                 variable      TARGET   abs_corr
1                  TARGET  1.00000000 1.00000000
2   prev_n_status_refused  0.06446886 0.06446886
3      prev_rate_approved -0.06352075 0.06352075
4 prev_mean_days_decision  0.04686437 0.04686437
5  prev_n_status_approved -0.03155333 0.03155333
6              prev_count  0.01976207 0.01976207
7    prev_mean_amt_credit -0.01611392 0.01611392</code></pre>
</div>
</div>
<p>Aggregated features such as prev_rate_approved and prev_n_status_refused show predictive signal. These should be included among candidate features; further engineered recency features may improve signal.</p>
</section>
<section id="data-problems-and-transformations" class="level1" data-number="9">
<h1 data-number="9"><span class="header-section-number">9</span> Data problems and transformations</h1>
<p>Key issues discovered:</p>
<ul>
<li>Sentinel values: DAYS_EMPLOYED had 365243 as a sentinel — replaced with NA. Missingness kept as feature.</li>
<li>High-missing columns: building-related fields have very high missingness and may be dropped or treated as special indicators depending on domain value.</li>
<li>Near-constant columns: many FLAG_DOCUMENT_* variables are nearly constant; assess variance and drop if zero variance.</li>
<li>Skewed monetary variables: AMT_INCOME_TOTAL, AMT_CREDIT, AMT_ANNUITY are right-skewed — consider log-transform for linear models.</li>
</ul>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb26"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb26-1"><a href="#cb26-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Example transformations to add</span></span>
<span id="cb26-2"><a href="#cb26-2" aria-hidden="true" tabindex="-1"></a>app_joined <span class="ot">&lt;-</span> app_joined <span class="sc">|&gt;</span> </span>
<span id="cb26-3"><a href="#cb26-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">AGE_YEARS =</span> <span class="sc">-</span>DAYS_BIRTH <span class="sc">/</span> <span class="fl">365.25</span>,</span>
<span id="cb26-4"><a href="#cb26-4" aria-hidden="true" tabindex="-1"></a>         <span class="at">CREDIT_INCOME_RATIO =</span> AMT_CREDIT <span class="sc">/</span> AMT_INCOME_TOTAL,</span>
<span id="cb26-5"><a href="#cb26-5" aria-hidden="true" tabindex="-1"></a>         <span class="at">ANNUITY_CREDIT_RATIO =</span> AMT_ANNUITY <span class="sc">/</span> AMT_CREDIT,</span>
<span id="cb26-6"><a href="#cb26-6" aria-hidden="true" tabindex="-1"></a>         <span class="at">HAS_PREV =</span> <span class="fu">as.integer</span>(<span class="sc">!</span><span class="fu">is.na</span>(prev_count)))</span>
<span id="cb26-7"><a href="#cb26-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-8"><a href="#cb26-8" aria-hidden="true" tabindex="-1"></a><span class="co"># Check near-zero variance columns (example subset)</span></span>
<span id="cb26-9"><a href="#cb26-9" aria-hidden="true" tabindex="-1"></a>flag_cols <span class="ot">&lt;-</span> app_joined <span class="sc">|&gt;</span> <span class="fu">select</span>(<span class="fu">starts_with</span>(<span class="st">"FLAG_DOCUMENT_"</span>))</span>
<span id="cb26-10"><a href="#cb26-10" aria-hidden="true" tabindex="-1"></a>nzv <span class="ot">&lt;-</span> <span class="fu">sapply</span>(flag_cols, <span class="cf">function</span>(x) { <span class="fu">length</span>(<span class="fu">unique</span>(x[<span class="sc">!</span><span class="fu">is.na</span>(x)])) <span class="sc">==</span> <span class="dv">1</span> })</span>
<span id="cb26-11"><a href="#cb26-11" aria-hidden="true" tabindex="-1"></a><span class="fu">sum</span>(nzv)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 0</code></pre>
</div>
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb28"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb28-1"><a href="#cb28-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Show a few transformed summaries</span></span>
<span id="cb28-2"><a href="#cb28-2" aria-hidden="true" tabindex="-1"></a>app_joined <span class="sc">|&gt;</span> <span class="fu">summarise</span>(<span class="at">median_age =</span> <span class="fu">median</span>(AGE_YEARS, <span class="at">na.rm =</span> <span class="cn">TRUE</span>),</span>
<span id="cb28-3"><a href="#cb28-3" aria-hidden="true" tabindex="-1"></a>                        <span class="at">median_credit_income =</span> <span class="fu">median</span>(CREDIT_INCOME_RATIO, <span class="at">na.rm =</span> <span class="cn">TRUE</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 1 × 2
  median_age median_credit_income
       &lt;dbl&gt;                &lt;dbl&gt;
1       43.1                 3.27</code></pre>
</div>
</div>
</section>
<section id="results-and-recommendations" class="level1" data-number="10">
<h1 data-number="10"><span class="header-section-number">10</span> Results and recommendations</h1>
<ul>
<li>Target is imbalanced (~91.93% majority accuracy). Use appropriate evaluation like ROC AUC, PR AUC, or resampling.</li>
<li>External scores (EXT_SOURCE_*) are the strongest single predictors; aggregated previous-application features (approval rate, number of refusals) add incremental signal.</li>
<li>NA missingness is structured (building features missing for many applicants; OWN_CAR_AGE missing if no car). Preserve missing indicators and consider domain-driven imputation.</li>
<li>Fix sentinel values (DAYS_EMPLOYED) and create derived features (EMPLOYMENT_YEARS, AGE_YEARS, ratios).</li>
<li>Drop or collapse near-constant columns; encode categorical variables appropriately for chosen model class.</li>
</ul>
</section>
<section id="how-i-used-ai-in-creating-this-notebook" class="level1" data-number="11">
<h1 data-number="11"><span class="header-section-number">11</span> How I used AI in creating this notebook</h1>
<p>I used an AI assistant to: outline the EDA structure, write and refine code snippets for data loading, missingness profiling, sentinel replacement, aggregation of previous applications, and to suggest interpretive text and recommendations. All code was executed locally in the R session; the AI suggested analyses and helped format the notebook.</p>
</section>
<section id="appendix-saving-the-joined-dataset" class="level1" data-number="12">
<h1 data-number="12"><span class="header-section-number">12</span> Appendix: saving the joined dataset</h1>
</section>

</main>
<!-- /main column -->
<script id="quarto-html-after-body" type="application/javascript">
  window.document.addEventListener("DOMContentLoaded", function (event) {
    const icon = "";
    const anchorJS = new window.AnchorJS();
    anchorJS.options = {
      placement: 'right',
      icon: icon
    };
    anchorJS.add('.anchored');
    const isCodeAnnotation = (el) => {
      for (const clz of el.classList) {
        if (clz.startsWith('code-annotation-')) {                     
          return true;
        }
      }
      return false;
    }
    const onCopySuccess = function(e) {
      // button target
      const button = e.trigger;
      // don't keep focus
      button.blur();
      // flash "checked"
      button.classList.add('code-copy-button-checked');
      var currentTitle = button.getAttribute("title");
      button.setAttribute("title", "Copied!");
      let tooltip;
      if (window.bootstrap) {
        button.setAttribute("data-bs-toggle", "tooltip");
        button.setAttribute("data-bs-placement", "left");
        button.setAttribute("data-bs-title", "Copied!");
        tooltip = new bootstrap.Tooltip(button, 
          { trigger: "manual", 
            customClass: "code-copy-button-tooltip",
            offset: [0, -8]});
        tooltip.show();    
      }
      setTimeout(function() {
        if (tooltip) {
          tooltip.hide();
          button.removeAttribute("data-bs-title");
          button.removeAttribute("data-bs-toggle");
          button.removeAttribute("data-bs-placement");
        }
        button.setAttribute("title", currentTitle);
        button.classList.remove('code-copy-button-checked');
      }, 1000);
      // clear code selection
      e.clearSelection();
    }
    const getTextToCopy = function(trigger) {
        const codeEl = trigger.previousElementSibling.cloneNode(true);
        for (const childEl of codeEl.children) {
          if (isCodeAnnotation(childEl)) {
            childEl.remove();
          }
        }
        return codeEl.innerText;
    }
    const clipboard = new window.ClipboardJS('.code-copy-button:not([data-in-quarto-modal])', {
      text: getTextToCopy
    });
    clipboard.on('success', onCopySuccess);
    if (window.document.getElementById('quarto-embedded-source-code-modal')) {
      const clipboardModal = new window.ClipboardJS('.code-copy-button[data-in-quarto-modal]', {
        text: getTextToCopy,
        container: window.document.getElementById('quarto-embedded-source-code-modal')
      });
      clipboardModal.on('success', onCopySuccess);
    }
      var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
      var mailtoRegex = new RegExp(/^mailto:/);
        var filterRegex = new RegExp('/' + window.location.host + '/');
      var isInternal = (href) => {
          return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
      }
      // Inspect non-navigation links and adorn them if external
     var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool):not(.about-link)');
      for (var i=0; i<links.length; i++) {
        const link = links[i];
        if (!isInternal(link.href)) {
          // undo the damage that might have been done by quarto-nav.js in the case of
          // links that we want to consider external
          if (link.dataset.originalHref !== undefined) {
            link.href = link.dataset.originalHref;
          }
        }
      }
    function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
      const config = {
        allowHTML: true,
        maxWidth: 500,
        delay: 100,
        arrow: false,
        appendTo: function(el) {
            return el.parentElement;
        },
        interactive: true,
        interactiveBorder: 10,
        theme: 'quarto',
        placement: 'bottom-start',
      };
      if (contentFn) {
        config.content = contentFn;
      }
      if (onTriggerFn) {
        config.onTrigger = onTriggerFn;
      }
      if (onUntriggerFn) {
        config.onUntrigger = onUntriggerFn;
      }
      window.tippy(el, config); 
    }
    const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
    for (var i=0; i<noterefs.length; i++) {
      const ref = noterefs[i];
      tippyHover(ref, function() {
        // use id or data attribute instead here
        let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
        try { href = new URL(href).hash; } catch {}
        const id = href.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note) {
          return note.innerHTML;
        } else {
          return "";
        }
      });
    }
    const xrefs = window.document.querySelectorAll('a.quarto-xref');
    const processXRef = (id, note) => {
      // Strip column container classes
      const stripColumnClz = (el) => {
        el.classList.remove("page-full", "page-columns");
        if (el.children) {
          for (const child of el.children) {
            stripColumnClz(child);
          }
        }
      }
      stripColumnClz(note)
      if (id === null || id.startsWith('sec-')) {
        // Special case sections, only their first couple elements
        const container = document.createElement("div");
        if (note.children && note.children.length > 2) {
          container.appendChild(note.children[0].cloneNode(true));
          for (let i = 1; i < note.children.length; i++) {
            const child = note.children[i];
            if (child.tagName === "P" && child.innerText === "") {
              continue;
            } else {
              container.appendChild(child.cloneNode(true));
              break;
            }
          }
          if (window.Quarto?.typesetMath) {
            window.Quarto.typesetMath(container);
          }
          return container.innerHTML
        } else {
          if (window.Quarto?.typesetMath) {
            window.Quarto.typesetMath(note);
          }
          return note.innerHTML;
        }
      } else {
        // Remove any anchor links if they are present
        const anchorLink = note.querySelector('a.anchorjs-link');
        if (anchorLink) {
          anchorLink.remove();
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        if (note.classList.contains("callout")) {
          return note.outerHTML;
        } else {
          return note.innerHTML;
        }
      }
    }
    for (var i=0; i<xrefs.length; i++) {
      const xref = xrefs[i];
      tippyHover(xref, undefined, function(instance) {
        instance.disable();
        let url = xref.getAttribute('href');
        let hash = undefined; 
        if (url.startsWith('#')) {
          hash = url;
        } else {
          try { hash = new URL(url).hash; } catch {}
        }
        if (hash) {
          const id = hash.replace(/^#\/?/, "");
          const note = window.document.getElementById(id);
          if (note !== null) {
            try {
              const html = processXRef(id, note.cloneNode(true));
              instance.setContent(html);
            } finally {
              instance.enable();
              instance.show();
            }
          } else {
            // See if we can fetch this
            fetch(url.split('#')[0])
            .then(res => res.text())
            .then(html => {
              const parser = new DOMParser();
              const htmlDoc = parser.parseFromString(html, "text/html");
              const note = htmlDoc.getElementById(id);
              if (note !== null) {
                const html = processXRef(id, note);
                instance.setContent(html);
              } 
            }).finally(() => {
              instance.enable();
              instance.show();
            });
          }
        } else {
          // See if we can fetch a full url (with no hash to target)
          // This is a special case and we should probably do some content thinning / targeting
          fetch(url)
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.querySelector('main.content');
            if (note !== null) {
              // This should only happen for chapter cross references
              // (since there is no id in the URL)
              // remove the first header
              if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
                note.children[0].remove();
              }
              const html = processXRef(null, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      }, function(instance) {
      });
    }
        let selectedAnnoteEl;
        const selectorForAnnotation = ( cell, annotation) => {
          let cellAttr = 'data-code-cell="' + cell + '"';
          let lineAttr = 'data-code-annotation="' +  annotation + '"';
          const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
          return selector;
        }
        const selectCodeLines = (annoteEl) => {
          const doc = window.document;
          const targetCell = annoteEl.getAttribute("data-target-cell");
          const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
          const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
          const lines = annoteSpan.getAttribute("data-code-lines").split(",");
          const lineIds = lines.map((line) => {
            return targetCell + "-" + line;
          })
          let top = null;
          let height = null;
          let parent = null;
          if (lineIds.length > 0) {
              //compute the position of the single el (top and bottom and make a div)
              const el = window.document.getElementById(lineIds[0]);
              top = el.offsetTop;
              height = el.offsetHeight;
              parent = el.parentElement.parentElement;
            if (lineIds.length > 1) {
              const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
              const bottom = lastEl.offsetTop + lastEl.offsetHeight;
              height = bottom - top;
            }
            if (top !== null && height !== null && parent !== null) {
              // cook up a div (if necessary) and position it 
              let div = window.document.getElementById("code-annotation-line-highlight");
              if (div === null) {
                div = window.document.createElement("div");
                div.setAttribute("id", "code-annotation-line-highlight");
                div.style.position = 'absolute';
                parent.appendChild(div);
              }
              div.style.top = top - 2 + "px";
              div.style.height = height + 4 + "px";
              div.style.left = 0;
              let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
              if (gutterDiv === null) {
                gutterDiv = window.document.createElement("div");
                gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
                gutterDiv.style.position = 'absolute';
                const codeCell = window.document.getElementById(targetCell);
                const gutter = codeCell.querySelector('.code-annotation-gutter');
                gutter.appendChild(gutterDiv);
              }
              gutterDiv.style.top = top - 2 + "px";
              gutterDiv.style.height = height + 4 + "px";
            }
            selectedAnnoteEl = annoteEl;
          }
        };
        const unselectCodeLines = () => {
          const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
          elementsIds.forEach((elId) => {
            const div = window.document.getElementById(elId);
            if (div) {
              div.remove();
            }
          });
          selectedAnnoteEl = undefined;
        };
          // Handle positioning of the toggle
      window.addEventListener(
        "resize",
        throttle(() => {
          elRect = undefined;
          if (selectedAnnoteEl) {
            selectCodeLines(selectedAnnoteEl);
          }
        }, 10)
      );
      function throttle(fn, ms) {
      let throttle = false;
      let timer;
        return (...args) => {
          if(!throttle) { // first call gets through
              fn.apply(this, args);
              throttle = true;
          } else { // all the others get throttled
              if(timer) clearTimeout(timer); // cancel #2
              timer = setTimeout(() => {
                fn.apply(this, args);
                timer = throttle = false;
              }, ms);
          }
        };
      }
        // Attach click handler to the DT
        const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
        for (const annoteDlNode of annoteDls) {
          annoteDlNode.addEventListener('click', (event) => {
            const clickedEl = event.target;
            if (clickedEl !== selectedAnnoteEl) {
              unselectCodeLines();
              const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
              if (activeEl) {
                activeEl.classList.remove('code-annotation-active');
              }
              selectCodeLines(clickedEl);
              clickedEl.classList.add('code-annotation-active');
            } else {
              // Unselect the line
              unselectCodeLines();
              clickedEl.classList.remove('code-annotation-active');
            }
          });
        }
    const findCites = (el) => {
      const parentEl = el.parentElement;
      if (parentEl) {
        const cites = parentEl.dataset.cites;
        if (cites) {
          return {
            el,
            cites: cites.split(' ')
          };
        } else {
          return findCites(el.parentElement)
        }
      } else {
        return undefined;
      }
    };
    var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
    for (var i=0; i<bibliorefs.length; i++) {
      const ref = bibliorefs[i];
      const citeInfo = findCites(ref);
      if (citeInfo) {
        tippyHover(citeInfo.el, function() {
          var popup = window.document.createElement('div');
          citeInfo.cites.forEach(function(cite) {
            var citeDiv = window.document.createElement('div');
            citeDiv.classList.add('hanging-indent');
            citeDiv.classList.add('csl-entry');
            var biblioDiv = window.document.getElementById('ref-' + cite);
            if (biblioDiv) {
              citeDiv.innerHTML = biblioDiv.innerHTML;
            }
            popup.appendChild(citeDiv);
          });
          return popup.innerHTML;
        });
      }
    }
  });
  </script>
</div> <!-- /content -->




</body></html>